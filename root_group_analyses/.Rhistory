##################################
### Data Exploration: LTER-SOM ###
###    Sept 2019, SWeintraub   ###
##################################
#Avni edits
### Reset workspace
rm(list = ls())
if (file.exists('/Users/5a7/')){
dir1 <- ("/Users/5a7/Documents/GitHub/lterwg-som/")
}
dir1
### Load data - straight from google drive
library(googledrive)
library(tidyverse)
source(paste0(dir1,'data-processing/get_latest_som.R'))
som <- get_latest_som()
som <- get_latest_som()
som <- get_latest_som()
t
if (file.exists('/Users/5a7/')){
dir1 <- ("/Users/5a7/Documents/GitHub/lterwg-som/")
}
source(paste0(dir1,'data-processing/get_latest_som.R'))
som <- get_latest_som()
som <- get_latest_som()
setwd("~/Documents/Fungi N Gradient/N Gradient Data")
stacked<-read.csv("stacked genes.csv")
stacked$gene<-factor(stacked$gene, levels=c("BG","CBD*","CBH*+","LACC*","lipH","MNP*","FKS1","NTH","PKS1","RHEL"))
genes.stacked<-ggplot(data=stacked, aes(x=F.or.Ambient, y=Rel.Abund/4))+ #divided by 4 because there are 4 replicate plots per site
geom_bar(aes(fill=gene), stat="identity")+
scale_fill_manual(values=c("steelblue1","steelblue3","steelblue4","sienna1","sienna3","sienna4","darkolivegreen2","darkolivegreen3","darkolivegreen4","darkgreen"))+
ylab("Relative Abundance")+
xlab("")+
#geom_text(aes(label=,y=0.6),fontface="bold",size= 6, hjust=0)+
guides(fill=guide_legend(title="Gene", title.theme = element_text(size=14, angle=0)))+
facet_grid(cols=vars(Site.ID))+
theme(panel.grid.major=element_blank(),
panel.grid.minor=element_blank(),
panel.border=element_rect(fill=NA, color="black"),
panel.background=element_rect(fill="white"),
axis.title=element_text(size=24),
axis.text.x=element_text(size=20),
axis.text.y=element_text(size=20),
plot.margin=unit(c(1,5,1,1), "lines"))
library(ggplot2)
genes.stacked<-ggplot(data=stacked, aes(x=F.or.Ambient, y=Rel.Abund/4))+ #divided by 4 because there are 4 replicate plots per site
geom_bar(aes(fill=gene), stat="identity")+
scale_fill_manual(values=c("steelblue1","steelblue3","steelblue4","sienna1","sienna3","sienna4","darkolivegreen2","darkolivegreen3","darkolivegreen4","darkgreen"))+
ylab("Relative Abundance")+
xlab("")+
#geom_text(aes(label=,y=0.6),fontface="bold",size= 6, hjust=0)+
guides(fill=guide_legend(title="Gene", title.theme = element_text(size=14, angle=0)))+
facet_grid(cols=vars(Site.ID))+
theme(panel.grid.major=element_blank(),
panel.grid.minor=element_blank(),
panel.border=element_rect(fill=NA, color="black"),
panel.background=element_rect(fill="white"),
axis.title=element_text(size=24),
axis.text.x=element_text(size=20),
axis.text.y=element_text(size=20),
plot.margin=unit(c(1,5,1,1), "lines"))
genes.stacked
View(stacked)
stacked$Site.ID<-factor(stacked$Site.ID, levels=c("NY1","ME","MA","NH","WV"))
genes.stacked<-ggplot(data=stacked, aes(x=F.or.Ambient, y=Rel.Abund/4))+ #divided by 4 because there are 4 replicate plots per site
geom_bar(aes(fill=gene), stat="identity")+
scale_fill_manual(values=c("steelblue1","steelblue3","steelblue4","sienna1","sienna3","sienna4","darkolivegreen2","darkolivegreen3","darkolivegreen4","darkgreen"))+
ylab("Relative Abundance")+
xlab("")+
#geom_text(aes(label=,y=0.6),fontface="bold",size= 6, hjust=0)+
guides(fill=guide_legend(title="Gene", title.theme = element_text(size=14, angle=0)))+
facet_grid(cols=vars(Site.ID))+
theme(panel.grid.major=element_blank(),
panel.grid.minor=element_blank(),
panel.border=element_rect(fill=NA, color="black"),
panel.background=element_rect(fill="white"),
axis.title=element_text(size=24),
axis.text.x=element_text(size=20),
axis.text.y=element_text(size=20),
plot.margin=unit(c(1,5,1,1), "lines"))
genes.stacked
ggsave(plot=genes.stacked, filename="stacked genes fig S4.tiff", dpi=300)
#BG R2=0.04 P = 0.15, CBH R2=0.05 P = 0.11, CDB R2=0.46, P<0.001, FKS1 R2=0.013 P=0.53, LACC R2=0.15 P = 0.02, lipH R2 = 0.16 P=0.01, MNP R2 = 0.26 P <0.01, NTH R2= 0.02 P=0.47, RNAHEL R2=0.37 P<0.001
corr.fig<-data.frame("Gene.Name"=c("BG","CBH","CBD","FKS1","LACC","lipH","MNP","NTH","RHEL","PKS1"), "group"=c("hydrolytic","hydrolytic","hydrolytic","stress","oxidative","oxidative","oxidative","stress","stress","stress"),"r"=c(0.26,0.28,0.69,0.11,-0.41,-0.43,-0.53,-0.13,0.63,-0.2),"P"=c(0.15,0.11,0.001,0.53,0.02,0.01,0.002,0.47,0.001,0.26))
corr.fig$Gene.Name<-factor(corr.fig$Gene.Name, levels=c("BG","CBH","CBD","LACC","lipH","MNP","FKS1","NTH","PKS1","RHEL"))
gene.corr<-ggplot(data=corr.fig, aes(x=Gene.Name, y=r))+
geom_bar(stat="identity", aes(fill=Gene.Name))+
scale_fill_manual(values=c("steelblue1","steelblue3","steelblue4","sienna1","sienna3","sienna4","darkolivegreen2","darkolivegreen3","darkolivegreen4","darkgreen"))+
scale_y_continuous(limits=c(-1,1))+
geom_hline(yintercept=0, color="black")+
annotate("text",x=c(3,10), y=c(0.7,0.65), label="***", size=6)+
annotate("text",x=6, y=c(-0.6), label="**", size=6)+
annotate("text",x=5, y=-0.5, label="*", size=6)+
annotate("text", x=2,y=1, label="Hydrolytic", size=6)+
annotate("text", x=5,y=1, label="Oxidative",size=6)+
annotate("text", x=8.5,y=1, label="Stress",size=6)+
ylab(bquote(Correlation~with~N~deposition~(r)))+
xlab("Functional Genes")+
geom_vline(xintercept=3.5, lty=2)+
geom_vline(xintercept=6.5, lty=2)+
#facet_grid(.~group)+
theme(legend.position="none",axis.title.y=element_text(size=24), axis.title.x=element_text(size=24),axis.text.y=element_text(size=20,color="black"), axis.text.x=element_text(size=20,color="black"),panel.grid.major=element_blank(),panel.grid.minor=element_blank(),panel.background=element_rect(fill="white",color="black"))
gene.corr
physta<- read.csv("phyla_avgs.csv")
setwd("~/Documents/Fungi N Gradient/N Gradient Data/From Mark")
physta<- read.csv("phyla_avgs.csv")
unique(physta$Site)
physta$Site<- factor(physta$Site, levels = c("NY1", "ME", "MA", "NH", "WV "))
physta
physta$Phylum<- factor(physta$Phylum, levels = c("Basidiomycota", "Ascomycota", "Mortierellomycota",
"Mucoromycota", "Rare", "Unassigned"))
ggplot(physta, aes(x = Fertilizer, y = mean, color = Phylum, fill = Phylum))+
geom_bar(stat = "identity")+
scale_color_manual(values = c("brown", "navyblue", "lightblue", "blue", "pink", "grey"))+
scale_fill_manual(values = c("brown", "navyblue", "lightblue", "blue", "pink", "grey"))+
theme_bw() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank())+
theme(axis.text.x = element_text(family="sans", angle = 45, hjust =1, vjust =1, size = 10, color = "black"))+
theme(axis.text.y = element_text(family="sans", size = 10, color = "black"))+
theme(axis.title.x = element_text(family="sans", size = 12, color = "black"))+
theme(axis.title.y = element_text(family="sans", size = 12, color = "black"))+
labs(x = "",
y = "Relative abundance (proportion of sequences)")+
theme(legend.position = "right")+
theme(legend.title = element_blank())+
facet_wrap(. ~ Site, ncol = 7)+
theme(strip.text.x = element_text(size = 10))+
theme(strip.background = element_rect(color = "white", fill = "white"))
phyla<-ggplot(physta, aes(x = Fertilizer, y = mean, color = Phylum, fill = Phylum))+
geom_bar(stat = "identity")+
scale_color_manual(values = c("brown", "navyblue", "lightblue", "blue", "pink", "grey"))+
scale_fill_manual(values = c("brown", "navyblue", "lightblue", "blue", "pink", "grey"))+
theme_bw() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank())+
theme(axis.text.x = element_text(family="sans", angle = 45, hjust =1, vjust =1, size = 10, color = "black"))+
theme(axis.text.y = element_text(family="sans", size = 10, color = "black"))+
theme(axis.title.x = element_text(family="sans", size = 12, color = "black"))+
theme(axis.title.y = element_text(family="sans", size = 12, color = "black"))+
labs(x = "",
y = "Relative abundance (proportion of sequences)")+
theme(legend.position = "right")+
theme(legend.title = element_blank())+
facet_wrap(. ~ Site, ncol = 7)+
theme(strip.text.x = element_text(size = 10))+
theme(strip.background = element_rect(color = "white", fill = "white"))
guidsta<- read.csv("guild_avg_relative_abundances.csv")
#Now let's plot the proportion of phyla across sites comparing fertilization treatment effects
ggplot(guidsta, aes(x = Ndep, y = mean2, color = group2, fill = group2))+
geom_point(stat = "identity", size = 2)+
scale_fill_manual(values = c("black", "grey"))+
scale_color_manual(values = c("black", "grey"))+
geom_errorbar(aes(ymax=(mean2+se2), ymin = (mean2-se2)), width = 0.15, col = "black")+
theme_bw() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank())+
theme(axis.text.x = element_text(family="sans", size = 10, color = "black"))+
theme(axis.text.y = element_text(family="sans", size = 10, color = "black"))+
theme(axis.title.x = element_text(family="sans", size = 12, color = "black"))+
theme(axis.title.y = element_text(family="sans", size = 12, color = "black"))+
labs(x = expression(paste("N-deposition (kg N " , ha^{-1}, " ", year^{-1},")","" )),
y = expression(paste("Fungal biomass (nmol PLFA" ," ", g^{-1},"soil * sequence proportion)" )))+
theme(legend.position = "right")+
theme(legend.title = element_blank())+
geom_smooth(aes(linetype = significance), method='lm', se = FALSE, size = 0.5)+
scale_linetype_manual(values = c("blank", "solid", "dashed"))+
theme(legend.text = element_text(size = 10, face = "bold"))+
facet_wrap(. ~ Guild, ncol = 1, scales = "free_y")+
theme(strip.text.x = element_text(size = 10))+
theme(strip.background = element_rect(color = "white", fill = "white"))
phyla<-ggplot(physta, aes(x = Fertilizer, y = mean, color = Phylum, fill = Phylum))+
geom_bar(stat = "identity")+
scale_color_manual(values = c("brown", "navyblue", "lightblue", "blue", "pink", "grey"))+
scale_fill_manual(values = c("brown", "navyblue", "lightblue", "blue", "pink", "grey"))+
theme_bw() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank())+
theme(axis.text.x = element_text(family="sans", angle = 45, hjust =1, vjust =1, size = 10, color = "black"))+
theme(axis.text.y = element_text(family="sans", size = 10, color = "black"))+
theme(axis.title.x = element_text(family="sans", size = 12, color = "black"))+
theme(axis.title.y = element_text(family="sans", size = 12, color = "black"))+
labs(x = "",
y = "Relative abundance (proportion of sequences)")+
theme(legend.position = "right")+
theme(legend.title = element_blank())+
facet_wrap(. ~ Site, ncol = 7)+
theme(strip.text.x = element_text(size = 10))+
theme(strip.background = element_rect(color = "white", fill = "white"))
phyla
#STACKED BAR PLOTS OF RELATIVE ABUNDACE
GUIDSTA<- read.csv("guild_avg_relative_abundances.csv")
GUIDSTA$Site<- factor(GUIDSTA$Site, levels = c("NY1", "ME", "NH", "MA", "WV"))
GUIDSTA$Guild<- factor(GUIDSTA$Guild, levels = c("Ectomycorrhizal", "Saprotroph", "White rot", "Other"))
ggplot(GUIDSTA, aes(x = group2, y = mean2, color = Guild, fill = Guild))+
geom_bar(stat = "identity")+
scale_color_manual(values = c("darkorange", "lightblue", "brown", "grey"))+
scale_fill_manual(values = c("darkorange", "lightblue", "brown", "grey"))+
theme_bw() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank())+
theme(axis.text.x = element_text(family="sans", angle = 45, hjust =1, vjust =1, size = 10, color = "black"))+
theme(axis.text.y = element_text(family="sans", size = 10, color = "black"))+
theme(axis.title.x = element_text(family="sans", size = 12, color = "black"))+
theme(axis.title.y = element_text(family="sans", size = 12, color = "black"))+
labs(x = "",
y = "Relative abundance (proportion of sequences)")+
theme(legend.position = "right")+
theme(legend.title = element_blank())+
facet_wrap(. ~ Site, ncol = 7)+
theme(strip.text.x = element_text(size = 10))+
theme(strip.background = element_rect(color = "white", fill = "white"))
GUIDSTA$Site<- factor(GUIDSTA$Site, levels = c("NY1", "ME", "MA", "NH", "WV"))
guild<-ggplot(GUIDSTA, aes(x = group2, y = mean2, color = Guild, fill = Guild))+
geom_bar(stat = "identity")+
scale_color_manual(values = c("darkorange", "lightblue", "brown", "grey"))+
scale_fill_manual(values = c("darkorange", "lightblue", "brown", "grey"))+
theme_bw() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank())+
theme(axis.text.x = element_text(family="sans", angle = 45, hjust =1, vjust =1, size = 10, color = "black"))+
theme(axis.text.y = element_text(family="sans", size = 10, color = "black"))+
theme(axis.title.x = element_text(family="sans", size = 12, color = "black"))+
theme(axis.title.y = element_text(family="sans", size = 12, color = "black"))+
labs(x = "",
y = "Relative abundance (proportion of sequences)")+
theme(legend.position = "right")+
theme(legend.title = element_blank())+
facet_wrap(. ~ Site, ncol = 7)+
theme(strip.text.x = element_text(size = 10))+
theme(strip.background = element_rect(color = "white", fill = "white"))
library(cowplot)
plot_grid(phyla, guild, nrow=1, align=H)
plot_grid(phyla, guild, nrow=1)
plot_grid(phyla, guild, nrow=2)
ggsave(plot=last_plot(), file="Fig_2_relabund.tiff", dpi=300)
guild<-ggplot(GUIDSTA, aes(x = group2, y = mean2, color = Guild, fill = Guild))+
geom_bar(stat = "identity")+
scale_color_manual(values = c("darkorange", "lightblue", "brown", "grey"))+
scale_fill_manual(values = c("darkorange", "lightblue", "brown", "grey"))+
theme_bw() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank())+
theme(axis.text.x = element_text(family="sans", angle = 45, hjust =1, vjust =1, size = 10, color = "black"))+
theme(axis.text.y = element_text(family="sans", size = 10, color = "black"))+
theme(axis.title.x = element_text(family="sans", size = 12, color = "black"))+
theme(axis.title.y = element_text(family="sans", size = 12, color = "black"))+
labs(x = "",
y = "Relative abundance")+
theme(legend.position = "right")+
theme(legend.title = element_blank())+
facet_wrap(. ~ Site, ncol = 7)+
theme(strip.text.x = element_text(size = 10))+
theme(strip.background = element_rect(color = "white", fill = "white"))
phyla<-ggplot(physta, aes(x = Fertilizer, y = mean, color = Phylum, fill = Phylum))+
geom_bar(stat = "identity")+
scale_color_manual(values = c("brown", "navyblue", "lightblue", "blue", "pink", "grey"))+
scale_fill_manual(values = c("brown", "navyblue", "lightblue", "blue", "pink", "grey"))+
theme_bw() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank())+
theme(axis.text.x = element_text(family="sans", angle = 45, hjust =1, vjust =1, size = 10, color = "black"))+
theme(axis.text.y = element_text(family="sans", size = 10, color = "black"))+
theme(axis.title.x = element_text(family="sans", size = 12, color = "black"))+
theme(axis.title.y = element_text(family="sans", size = 12, color = "black"))+
labs(x = "",
y = "Relative abundance")+
theme(legend.position = "right")+
theme(legend.title = element_blank())+
facet_wrap(. ~ Site, ncol = 7)+
theme(strip.text.x = element_text(size = 10))+
theme(strip.background = element_rect(color = "white", fill = "white"))
plot_grid(phyla, guild, nrow=2)
ggsave(plot=last_plot(), file="Fig_2_relabund.tiff", dpi=300)
View(GUIDSTA)
#Let's look at the relative abundance of guilds now
Guilds<- read.csv("Guild_min.csv", row.names=1)
envt<- read.csv("Envt.csv", row.names=1)
envt2<- read.csv("N-envt.csv")
View(envt2)
View(Guilds)
Gui2<- cbind(envt2, Guilds)
Gui2$Fertilized.or.Ambient
#Ascomycota
emf<- describeBy((Gui2$Total.Fungi.nmol.g*Gui2$Total.EMF), group=list(Gui2$Ndep.2016,Gui2$Fertilized.or.Ambient), mat = TRUE, na.rm = TRUE)
install.packages("psych")
#Ascomycota
library(psych)
install.packages("mnormt")
View(Gui2)
setwd("~/Documents/GitHub/lterwg-som/root_group_analyses")
if (file.exists('/Users/5a7/')){
dir1 <- ("/Users/5a7/Documents/GitHub/lterwg-som/")
}
### Load data - straight from google drive
library(googledrive)
library(tidyverse)
library(dplyr)
library(ggplot2)
source(paste0(dir1,'data-processing/get_latest_som.R'))
som <- get_latest_som() #HINT: Select 0 and re-authorize the google api each time. Not sure why the pre-auth isn't working.
m
som <- get_latest_som() #HINT: Select 0 and re-authorize the google api each time. Not sure why the pre-auth isn't working.
som <- get_latest_som() #HINT: Select 0 and re-authorize the google api each time. Not sure why the pre-auth isn't working.
source(paste0(dir1,'data-processing/get_latest_som.R'))
som <- get_latest_som() #HINT: Select 0 and re-authorize the google api each time. Not sure why the pre-auth isn't working.
##################################
### Data Exploration: LTER-SOM ###
###    Sept 2019, SWeintraub   ###
##################################
#Avni edits
### Reset workspace
rm(list = ls())
if (file.exists('/Users/5a7/')){
dir1 <- ("/Users/5a7/Documents/GitHub/lterwg-som/")
}
source(paste0(dir1,'data-processing/get_latest_som.R'))
som <- get_latest_som() #HINT: Select 0 and re-authorize the google api each time. Not sure why the pre-auth isn't working.
