We identified data contributors who were familiar with datasets available from individual study sites and research networks. Many of the datasets in SoDaH were already published in public repositories like the Environmental Data Initiative (EDI; the primary repository for LTER data), or available through the NEON data portal. Other datasets that we wanted to include in SoDaH, however, had not been published or were difficult to find or identify (mainly data from CZO sites and the DIRT network, but also some LTER data). 

The SoDaH database was constructed by data contributions from individual sites or research networks who provided flat (.csv) files. The dataset (or datasets) from each site, study, or network were placed in their own subdirectory along with a metadata template that was used to map variable names in the raw data to the structure of SoDaH. The metadata template was developed to facilitate data harmonization in a scripted, repeatable manner that maintained the integrity of the raw datasets (https://lter.github.io/som-website/database.html). To simplify the workflow for data contributors, the metadata template only includes a single tab each for location and profile data; within these tabs, data contributors are able to add information on metadata, and layer fields. This step of our data harmonization still requires manual effort from data providers, as they have to map the names of measured variables from raw data with the appropriate variable in SoDaH. Data contributors enter relevant metadata and site information that may not be included in the raw data sets. They provide additional information from controlled drop-down cells with information on units for each variable (e.g., %C, g C kg-1 soil, mg C kg-1 soil, etc.) or on methodologies used (e.g., soil P measured by Bray, Melich, etc.). In the harmonized dataset, we convert units to a standard output and include methodological information. This approach accommodates a broad suite of soil and related variables (e.g., climate, vegetation characteristics, ecosystem productivity, etc.). 

The metadata template matches site-level information with the detailed measurements collected at each study site. Data on the profile tab corresponds to columns of variables that are reported in the raw data (e.g., soil C in each experimental plot). The metadata template assumes that data on the location tab represent site characteristics for a single site or location (e.g., Prospect Hill Warming experiment at Harvard Forest). The harmonization script copies each unique measurement from the profile tab into a column of data in the harmonized dataset. By contrast, data provided on the location tab (latitude, longitude, mean annual temperature, etc.) are broadcast to every row of the harmonized dataset. Data contributors, however, can move variables from the location to profile tabs when appropriate (e.g., moving site information on climate onto the profile tab for NutNet and NEON data). 

The harmonization script can harmonize multiple datasets from the same study location. For example, a dataset may consist of multiple data files that each contain details about different aspects of the study (e.g., soil data in one file, aboveground productivity in another file); the harmonization script will harvest all variables identified in the metadata file from the suite of data files (as long as they are in the same directory as the metadata file). However, because SoDaH is a flat database, values from these different data files will be stacked, requiring additional aggregation steps to align data within sites.  

We developed the soilHarmonization package in R to harmonize and aggregate the SoDaH database. The soilHarmonization package is publicly available (https://github.com/lter/soilHarmonization), and includes tools to read and harmonize user-provided raw data that are mapped to a metadata template with controlled vocabulary and standard units. Users point to the directory where Level-0 data are located (raw data and metadata template), and the soilHarmonization package generates a new flat file(s) in which the variable names and units, if relevant, are standardized in the output (Level-1 data). The harmonized dataset includes unique columns of data from those defined in the profile tab as well as columns of data with site-level information from the location tab. The package also includes a suite of QC tools that confirm proper data type (e.g., strings are not interspersed with numeric values) and that numeric data, once converted to appropriate units, fall within an expected range. A summary of inputs, outputs, homogenization steps, and a QC report are detailed in an accompanying document (.pdf) for each harmonized dataset. These Level-1 data products are stored in the same directory as the Level-0 data with resulting output identified with a modified filename.

After generating Level-1 data from all Level-0 data, we combined harmonized data files into an aggregated dataset. The resulting SoDaH database is described and presented here as a single, flat dataset that has columns corresponding to variables in the metadata template and rows for each measurement. 
